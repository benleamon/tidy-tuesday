---
title: "Avatar"
author: "Ben Leamon"
date: "15/08/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(tidytext)
```

```{r}
tuesdata <- tidytuesdayR::tt_load('2020-08-11')
```

```{r}
avatar <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-08-11/avatar.csv')
scene_description <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-08-11/scene_description.csv')

```

# Strip out the theme song words.
```{r}
distinct_lines <- avatar%>% distinct(full_text)
theme_song = distinct_lines$full_text[1]

theme_song <- "Water. Earth. Fire. Air. Long ago, the four nations lived together in harmony. Then, everything changed when the Fire Nation attacked. Only the Avatar, master of all four elements, could stop them, but when the world needed him most, he vanished. A hundred years passed, and my brother and I discovered the new Avatar, an airbender named Aang. And although his airbending skills are great, he has a lot to learn before he's ready to save anyone. But I believe Aang can save the world."
first_theme <- "Water. Earth. Fire. Air. My grandmother used to tell me stories about the old days: a time of peace when the Avatar kept balance between the Water Tribes, Earth Kingdom, Fire Nation and Air Nomads. But that all changed when the Fire Nation attacked. Only the Avatar mastered all four elements; only he could stop the ruthless firebenders. But when the world needed him most, he vanished. A hundred years have passed, and the Fire Nation is nearing victory in the war. Two years ago, my father and the men of my tribe journeyed to the Earth Kingdom to help fight against the Fire Nation, leaving me and my brother to look after our tribe. Some people believe that the Avatar was never reborn into the Air Nomads and that the cycle is broken, but I haven't lost hope. I still believe that, somehow, the Avatar will return to save the world."
themes <- c(theme_song, first_theme)

dialogue <- avatar %>%
  filter(!(full_text %in% themes))

```

# Get number of words/sentance
```{r}
a_word <- "([^ ]+)"
no_dots <- " \\.\\.\\."
no_dashes <- " \\-\\-"



dialogue <- dialogue %>%
  mutate(word_number = str_count(character_words, a_word) - str_count(character_words, no_dots) - str_count(character_words, no_dashes))
```

# Add a season-episode id: 
```{r}
dialogue <- dialogue %>%
  unite(season_ep, book_num, chapter_num, sep = ".", remove = FALSE) %>%
  mutate(
    #season_ep = as.double(season_ep)
  )
```

# Possible things to look at: 
## What charactars are in what epiodes?
```{r}
characters <- dialogue %>%
  group_by(chapter, season_ep) %>%
  distinct(character)
```

## How many times does each character show up?
```{r}
# Now just to get the number of times a character shows up 
top_characters <- characters %>%
  group_by(character) %>%
  count(character, sort = TRUE)
```

## Episode rankings over time
```{r}
dialogue %>%
  distinct(book,book_num, chapter_num, chapter, imdb_rating) %>%
  ggplot(aes(chapter_num, imdb_rating, color = book)) + 
  geom_point()+
  facet_wrap(~book_num)
  
```

## ep ranking by author
Are there enough writers to make this interesting?
```{r}
dialogue %>%
  count(writer, sort = TRUE)

```
Yes. 
Does the writer have any relationship to IMDB rating
```{r}
dialogue %>%
  ggplot(aes(imdb_rating, writer))+
  geom_boxplot()
```
Hmm...

## Relationship between director and scores? 
How many directors? 
```{r}
dialogue %>%
  distinct(chapter, director) %>%
  count(director, sort = TRUE)
```
Director and IMDB
```{r}
dialogue %>%
  distinct (chapter, director, imdb_rating) %>%
  ggplot(aes(director, imdb_rating))+
  geom_violin()
```
I wonder how much influence the director actually has on quality... 

## does writer or director matter more? 

## Tokenize the words
```{r}
data(stop_words)

tidy_dialogue <- dialogue %>%
  select(character, character_words, season_ep) %>%
  mutate(id = row_number())%>%
  unnest_tokens(word, character_words)

tidy_dialogue <- tidy_dialogue %>%
  anti_join(stop_words)

tidy_dialogue
```
## What are the most common words in the series? 
```{r}
tidy_dialogue %>%
  count(word, sort = TRUE)
```
## most common words/ character
```{r}
interested <- c("Aang", "Katara", "Toph", "Sokka", "Zuko", "Iroh")

dialogue_ordered <- tidy_dialogue %>%
  group_by(character) %>%
  #filter(character == "Aang") %>%
  filter(character %in% interested) %>%
  count(word) %>%
  slice_max(order_by = n, n = 10) %>%
  ungroup()%>%
  mutate(character = as.factor(character),
         word = reorder_within(word, n, character))
  
ggplot(dialogue_ordered, aes(n, word))+
    geom_col()+
    facet_wrap(~character, scales = "free")+
    scale_y_reordered()
```


##most common words/character (non-main charctar)

##charactar words/episode
